<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ˜éšŠç®¡ç† - hAIre æ‹›å‹Ÿç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- è¼‰å…¥é…ç½®æ–‡ä»¶ -->
    <script src="js/config.js"></script>
    
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .header-section {
            background: linear-gradient(135deg, #0047AB 0%, #003d99 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        
        .back-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
            transform: translateX(-3px);
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 600;
            margin: 0;
        }
        
        .main-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .table-container {
            padding: 2rem;
        }
        
        .btn-add {
            background: linear-gradient(135deg, #0047AB 0%, #003d99 100%);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,71,171,0.4);
            color: white;
        }
        
        .table {
            margin-top: 1.5rem;
        }
        
        .table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }
        
        .btn-action {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 6px;
            margin-right: 0.5rem;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #0047AB 0%, #003d99 100%);
            color: white;
        }
        
        .modal-header .btn-close {
            filter: invert(1);
        }
        
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #0047AB;
            background-color: #f8f9ff;
        }
        
        .upload-area.dragover {
            border-color: #0047AB;
            background-color: #e3f2fd;
        }
        
        /* åœ˜éšŠå¡ç‰‡æ¨£å¼ */
        .team-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            border: 1px solid #e9ecef;
        }
        
        .team-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,71,171,0.15);
        }
        
        .team-card-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .team-id {
            background: #f8f9fa;
            color: #0047AB;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            flex: 1;
        }
        
        .team-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-view, .btn-edit, .btn-delete {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .btn-view {
            background: #28a745;
            color: white;
        }
        
        .btn-view:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .btn-edit {
            background: #17a2b8;
            color: white;
        }
        
        .btn-edit:hover {
            background: #138496;
            transform: translateY(-1px);
        }
        
        .btn-delete {
            background: #dc3545;
            color: white;
        }
        
        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-1px);
        }
        
        .team-info h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #212529;
        }
        
        .team-info .company {
            color: #0047AB;
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .team-info .department {
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        .team-info .codes {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        .team-info .description {
            color: #495057;
            margin-bottom: 0.75rem;
            font-style: italic;
        }
        
        .team-info .created-at {
            font-size: 0.8rem;
            color: #adb5bd;
        }
        
        /* Toast é€šçŸ¥æ¨£å¼ */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            min-width: 300px;
            border-left: 4px solid #0047AB;
        }
        
        .toast.success {
            border-left-color: #28a745;
        }
        
        .toast.error {
            border-left-color: #dc3545;
        }
        
        .toast.info {
            border-left-color: #17a2b8;
        }
        
        .toast-header {
            background-color: #f8f9fa;
        }
        
        /* æ–‡ä»¶åˆ—è¡¨æ¨£å¼ */
        .file-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 71, 171, 0.1);
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="header-section">
        <div class="container">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i>
                è¿”å›ä¸»é 
            </a>
            <h1 class="page-title">
                <i class="fas fa-users-cog me-3"></i>
                åœ˜éšŠç®¡ç†
            </h1>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">åœ˜éšŠåˆ—è¡¨</h2>
                    <button type="button" class="btn btn-add" data-bs-toggle="modal" data-bs-target="#addTeamModal">
                        <i class="fas fa-plus me-2"></i>æ–°å¢åœ˜éšŠ
                    </button>
                </div>
                
                <!-- æœå°‹å’Œç¯©é¸å€åŸŸ -->
                <div class="mb-4">
                    <div class="row">
                        <div class="col-md-8">
                            <input type="text" id="searchInput" class="form-control" placeholder="æœå°‹åœ˜éšŠåç¨±ã€å…¬å¸ã€éƒ¨é–€...">
                        </div>
                        <div class="col-md-4">
                            <select id="companyFilter" class="form-select">
                                <option value="">æ‰€æœ‰å…¬å¸</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- è¼‰å…¥ç‹€æ…‹ -->
                <div id="loadingSpinner" class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">è¼‰å…¥ä¸­...</span>
                    </div>
                    <div class="mt-2">è¼‰å…¥åœ˜éšŠè³‡æ–™ä¸­...</div>
                </div>
                
                <!-- åœ˜éšŠåˆ—è¡¨å®¹å™¨ -->
                <div id="teamsContainer" style="display: none;">
                    <div id="teamsGrid" class="row">
                        <!-- åœ˜éšŠå¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
                
                <!-- ç©ºç‹€æ…‹ -->
                <div id="emptyState" class="text-center py-5" style="display: none;">
                    <i class="fas fa-users text-muted" style="font-size: 4rem;"></i>
                    <h4 class="mt-3 text-muted">å°šç„¡åœ˜éšŠè³‡æ–™</h4>
                    <p class="text-muted">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢åœ˜éšŠã€æŒ‰éˆ•ä¾†å»ºç«‹ç¬¬ä¸€å€‹åœ˜éšŠ</p>
                </div>
                
                <!-- èˆŠçš„è¡¨æ ¼çµæ§‹ä¿ç•™ä½œç‚ºå‚™ç”¨ -->
                <table class="table table-striped table-hover d-none" id="teamsTable">
                    <thead>
                        <tr>
                            <th>å…¬å¸</th>
                            <th>éƒ¨é–€</th>
                            <th>åœ˜éšŠåç¨±</th>
                            <th>åœ˜éšŠæè¿°</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- å‹•æ…‹è¼‰å…¥çš„åœ˜éšŠè³‡æ–™ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- æ–°å¢åœ˜éšŠ Modal -->
    <div class="modal fade" id="addTeamModal" tabindex="-1" aria-labelledby="addTeamModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addTeamModalLabel">
                        <i class="fas fa-plus me-2"></i>æ–°å¢åœ˜éšŠ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <form id="addTeamForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="company" class="form-label">å…¬å¸åç¨± *</label>
                                    <input type="text" class="form-control" id="company" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="companyCode" class="form-label">å…¬å¸ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="companyCode" required 
                                           placeholder="ä¾‹å¦‚ï¼šCXI, CATHAY, FUBON" maxlength="8" style="text-transform: uppercase;">
                                    <div class="form-text">2-8å€‹è‹±æ•¸å­—ï¼Œä¾‹å¦‚ï¼šCXIï¼ˆåœ‹æ³°ç”¢éšªï¼‰ã€CATHAYï¼ˆåœ‹æ³°é‡‘æ§ï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="department" class="form-label">éƒ¨é–€åç¨± *</label>
                                    <input type="text" class="form-control" id="department" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="deptCode" class="form-label">éƒ¨é–€ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="deptCode" required 
                                           placeholder="ä¾‹å¦‚ï¼šDATAAI, IT, HR, FINANCE" maxlength="10" style="text-transform: uppercase;">
                                    <div class="form-text">2-10å€‹è‹±æ•¸å­—ï¼Œä¾‹å¦‚ï¼šDATAAIï¼ˆæ•¸æ“šAIéƒ¨ï¼‰ã€ITï¼ˆè³‡è¨Šéƒ¨ï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="teamName" class="form-label">åœ˜éšŠ/ç§‘åˆ¥åç¨± *</label>
                                    <input type="text" class="form-control" id="teamName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="teamCode" class="form-label">ç§‘åˆ¥ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="teamCode" required 
                                           placeholder="ä¾‹å¦‚ï¼šCI, CT, DEV, QA" maxlength="8" style="text-transform: uppercase;">
                                    <div class="form-text">2-8å€‹è‹±æ•¸å­—ï¼Œä¾‹å¦‚ï¼šCIï¼ˆä¼æ¥­æ™ºèƒ½ç§‘ï¼‰ã€CTï¼ˆå®¢æˆ¶ç§‘æŠ€ç§‘ï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="teamDescription" class="form-label">åœ˜éšŠæè¿°</label>
                            <textarea class="form-control" id="teamDescription" rows="3" 
                                      placeholder="ä¾‹å¦‚ï¼šè² è²¬ä¼æ¥­æ™ºèƒ½åŒ–å°ˆæ¡ˆé–‹ç™¼èˆ‡ç¶­é‹"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>é è¦½è³‡è¨Šï¼š</strong>
                                <div class="mt-2">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <small class="text-muted">å…¬å¸ä»£ç¢¼é è¦½ï¼š</small>
                                            <div id="companyCodePreview" class="fw-bold">è«‹å¡«å¯«å…¬å¸ä»£ç¢¼</div>
                                        </div>
                                        <div class="col-md-6">
                                            <small class="text-muted">åœ˜éšŠ ID é è¦½ï¼š</small>
                                            <div id="teamIdPreview" class="fw-bold text-primary">è«‹å¡«å¯«å¿…è¦æ¬„ä½</div>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-md-12">
                                            <small class="text-muted">å®Œæ•´åœ˜éšŠåç¨±é è¦½ï¼š</small>
                                            <div id="fullTeamNamePreview" class="fw-bold text-success">è«‹å¡«å¯«åœ˜éšŠè³‡è¨Š</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">åœ˜éšŠç›¸é—œæ–‡ä»¶ä¸Šå‚³ (å¯é¸)</label>
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <p class="mb-2">é»æ“Šæˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤è™•</p>
                                <p class="text-muted small">æ”¯æ´ TXT, JSON, CSV, PDF æ ¼å¼</p>
                                <input type="file" id="fileInput" multiple accept=".txt,.json,.csv,.pdf" style="display: none;">
                            </div>
                            <div id="fileList" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" id="createTeam" class="btn btn-primary">å„²å­˜åœ˜éšŠ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç·¨è¼¯åœ˜éšŠ Modal -->
    <div class="modal fade" id="editTeamModal" tabindex="-1" aria-labelledby="editTeamModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editTeamModalLabel">
                        <i class="fas fa-edit me-2"></i>ç·¨è¼¯åœ˜éšŠ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body">
                    <form id="editTeamForm">
                        <input type="hidden" id="editTeamId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editCompany" class="form-label">å…¬å¸åç¨± *</label>
                                    <input type="text" class="form-control" id="editCompany" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editCompanyCode" class="form-label">å…¬å¸ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="editCompanyCode" readonly
                                           placeholder="ä¾‹å¦‚ï¼šCXI, CATHAY, FUBON" maxlength="8" style="text-transform: uppercase; background-color: #f8f9fa;">
                                    <div class="form-text text-warning">âš ï¸ å…¬å¸ä»£ç¢¼ä¸å¯ä¿®æ”¹ï¼ˆæœƒå½±éŸ¿åœ˜éšŠIDï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editDepartment" class="form-label">éƒ¨é–€åç¨± *</label>
                                    <input type="text" class="form-control" id="editDepartment" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editDeptCode" class="form-label">éƒ¨é–€ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="editDeptCode" readonly
                                           placeholder="ä¾‹å¦‚ï¼šDATAAI, IT, HR, FINANCE" maxlength="10" style="text-transform: uppercase; background-color: #f8f9fa;">
                                    <div class="form-text text-warning">âš ï¸ éƒ¨é–€ä»£ç¢¼ä¸å¯ä¿®æ”¹ï¼ˆæœƒå½±éŸ¿åœ˜éšŠIDï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editTeamName" class="form-label">åœ˜éšŠ/ç§‘åˆ¥åç¨± *</label>
                                    <input type="text" class="form-control" id="editTeamName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editTeamCode" class="form-label">ç§‘åˆ¥ä»£ç¢¼ *</label>
                                    <input type="text" class="form-control" id="editTeamCode" readonly
                                           placeholder="ä¾‹å¦‚ï¼šCI, CT, DEV, QA" maxlength="8" style="text-transform: uppercase; background-color: #f8f9fa;">
                                    <div class="form-text text-warning">âš ï¸ ç§‘åˆ¥ä»£ç¢¼ä¸å¯ä¿®æ”¹ï¼ˆæœƒå½±éŸ¿åœ˜éšŠIDï¼‰</div>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTeamDescription" class="form-label">åœ˜éšŠæè¿°</label>
                            <textarea class="form-control" id="editTeamDescription" rows="3" 
                                      placeholder="ä¾‹å¦‚ï¼šè² è²¬ä¼æ¥­æ™ºèƒ½åŒ–å°ˆæ¡ˆé–‹ç™¼èˆ‡ç¶­é‹"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ç¾æœ‰æ–‡ä»¶</label>
                            <div id="existingFiles" class="border rounded p-3 bg-light">
                                <!-- ç¾æœ‰æ–‡ä»¶åˆ—è¡¨ -->
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ä¸Šå‚³æ–°æ–‡ä»¶ (å¯é¸)</label>
                            <div class="upload-area" id="editUploadArea">
                                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                <p class="mb-2">é»æ“Šæˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤è™•</p>
                                <p class="text-muted small">æ”¯æ´ TXT, JSON, CSV, PDF æ ¼å¼</p>
                                <input type="file" id="editFileInput" multiple accept=".txt,.json,.csv,.pdf" style="display: none;">
                            </div>
                            <div id="editFileList" class="mt-2"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" id="updateTeam" class="btn btn-primary">æ›´æ–°åœ˜éšŠ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- åœ˜éšŠè©³æƒ… Modal -->
    <div class="modal fade" id="teamDetailModal" tabindex="-1" aria-labelledby="teamDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="teamDetailModalLabel">
                        <i class="fas fa-info-circle me-2"></i>åœ˜éšŠè©³æƒ…
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
                </div>
                <div class="modal-body" id="teamDetailContent">
                    <!-- åœ˜éšŠè©³æƒ…å…§å®¹ -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>
                    <button type="button" class="btn btn-primary" id="editFromDetail">ç·¨è¼¯åœ˜éšŠ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast è¨Šæ¯å®¹å™¨ -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="messageToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" style="display: none;">
            <div class="toast-header">
                <div id="toastIcon" class="me-2"></div>
                <strong id="toastTitle" class="me-auto">è¨Šæ¯</strong>
                <button type="button" class="btn-close" onclick="hideToast()" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <div id="toastMessage"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // å…¨åŸŸè®Šæ•¸
        let teamsData = [];
        let selectedFiles = [];
        let editSelectedFiles = [];

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            
            // æª¢æŸ¥é…ç½®
            if (window.CONFIG) {
                console.log('âœ… é…ç½®è¼‰å…¥æˆåŠŸ:', window.CONFIG);
            } else {
                console.error('âŒ é…ç½®è¼‰å…¥å¤±æ•—');
            }
            
            // è¼‰å…¥åœ˜éšŠè³‡æ–™
            fetchTeams();
            
            // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
            initializeEventListeners();
        });

        // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
        function initializeEventListeners() {
            // æ–°å¢åœ˜éšŠæŒ‰éˆ•
            document.getElementById('createTeam').addEventListener('click', createTeam);
            
            // æ›´æ–°åœ˜éšŠæŒ‰éˆ•
            document.getElementById('updateTeam').addEventListener('click', updateTeam);
            
            // æ–‡ä»¶ä¸Šå‚³ç›¸é—œ
            setupFileUpload('uploadArea', 'fileInput', 'fileList', selectedFiles);
            setupFileUpload('editUploadArea', 'editFileInput', 'editFileList', editSelectedFiles);
            
            // å¾è©³æƒ…é ç·¨è¼¯
            document.getElementById('editFromDetail').addEventListener('click', function() {
                const teamId = this.getAttribute('data-team-id');
                showEditModal(teamId);
                bootstrap.Modal.getInstance(document.getElementById('teamDetailModal')).hide();
            });

            // æ–°å¢åœ˜éšŠé è¦½åŠŸèƒ½
            const previewFields = ['company', 'companyCode', 'department', 'deptCode', 'teamName', 'teamCode'];
            previewFields.forEach(fieldId => {
                document.getElementById(fieldId).addEventListener('input', updateAllPreviews);
            });
        }

        // è¨­ç½®æ–‡ä»¶ä¸Šå‚³åŠŸèƒ½
        function setupFileUpload(areaId, inputId, listId, filesArray) {
            const uploadArea = document.getElementById(areaId);
            const fileInput = document.getElementById(inputId);
            const fileList = document.getElementById(listId);

            // é»æ“Šä¸Šå‚³å€åŸŸè§¸ç™¼æ–‡ä»¶é¸æ“‡
            uploadArea.addEventListener('click', () => fileInput.click());

            // æ–‡ä»¶é¸æ“‡äº‹ä»¶
            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files, filesArray, fileList);
            });

            // æ‹–æ‹½äº‹ä»¶
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files, filesArray, fileList);
            });
        }

        // è™•ç†æ–‡ä»¶
        function handleFiles(files, filesArray, fileListElement) {
            for (let file of files) {
                if (isValidFileType(file)) {
                    filesArray.push(file);
                } else {
                    alert(`æª”æ¡ˆ ${file.name} æ ¼å¼ä¸æ”¯æ´ï¼Œåƒ…æ”¯æ´ TXT, JSON, CSV, PDF æ ¼å¼ã€‚`);
                }
            }
            renderFileList(filesArray, fileListElement);
        }

        // é©—è­‰æ–‡ä»¶é¡å‹
        function isValidFileType(file) {
            const allowedTypes = ['.txt', '.json', '.csv', '.pdf'];
            const fileName = file.name.toLowerCase();
            return allowedTypes.some(type => fileName.endsWith(type));
        }

        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFileList(filesArray, fileListElement) {
            fileListElement.innerHTML = '';
            filesArray.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'alert alert-info alert-dismissible fade show';
                fileItem.innerHTML = `
                    <i class="fas fa-file me-2"></i>${file.name}
                    <button type="button" class="btn-close" onclick="removeFile(${index}, '${fileListElement.id}')"></button>
                `;
                fileListElement.appendChild(fileItem);
            });
        }

        // ç§»é™¤æ–‡ä»¶
        function removeFile(index, listId) {
            if (listId === 'fileList') {
                selectedFiles.splice(index, 1);
                renderFileList(selectedFiles, document.getElementById('fileList'));
            } else if (listId === 'editFileList') {
                editSelectedFiles.splice(index, 1);
                renderFileList(editSelectedFiles, document.getElementById('editFileList'));
            }
        }

        // è¼‰å…¥åœ˜éšŠè³‡æ–™
        async function fetchTeams() {
            try {
                console.log('ğŸ”„ é–‹å§‹è¼‰å…¥åœ˜éšŠè³‡æ–™...');
                
                // ä½¿ç”¨æ­£ç¢ºçš„ API URL
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                console.log('ğŸ”— API URL:', apiUrl + '/teams');
                
                const response = await fetch(apiUrl + '/teams', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                console.log('ğŸ“¡ API å›æ‡‰ç‹€æ…‹:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('âœ… åœ˜éšŠè³‡æ–™è¼‰å…¥æˆåŠŸ:', data);
                
                teamsData = data.teams || data; // è™•ç†å¯èƒ½çš„è³‡æ–™çµæ§‹å·®ç•°
                renderTeamsTable(teamsData);
                
            } catch (error) {
                console.error('âŒ è¼‰å…¥åœ˜éšŠè³‡æ–™å¤±æ•—:', error);
                showAlert('è¼‰å…¥åœ˜éšŠè³‡æ–™å¤±æ•—: ' + error.message, 'danger');
            }
        }

        // æ¸²æŸ“åœ˜éšŠè¡¨æ ¼
        function renderTeamsTable(teams) {
            const tbody = document.querySelector('#teamsTable tbody');
            tbody.innerHTML = '';

            if (!teams || teams.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                            å°šç„¡åœ˜éšŠè³‡æ–™
                        </td>
                    </tr>
                `;
                return;
            }

            teams.forEach(team => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${team.company || ''}</td>
                    <td>${team.department || ''}</td>
                    <td>${team.team_name || ''}</td>
                    <td>
                        <div class="text-truncate" style="max-width: 200px;" title="${team.description || ''}">
                            ${team.description || ''}
                        </div>
                    </td>
                    <td>
                        <button class="btn btn-info btn-action btn-sm" onclick="showTeamDetail('${team.team_id}')">
                            <i class="fas fa-eye"></i> æª¢è¦–
                        </button>
                        <button class="btn btn-primary btn-action btn-sm" onclick="showEditModal('${team.team_id}')">
                            <i class="fas fa-edit"></i> ç·¨è¼¯
                        </button>
                        <button class="btn btn-danger btn-action btn-sm" onclick="deleteTeam('${team.team_id}')">
                            <i class="fas fa-trash"></i> åˆªé™¤
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // å»ºç«‹åœ˜éšŠ
        async function createTeam() {
            try {
                const requiredFields = ['company', 'companyCode', 'department', 'deptCode', 'teamName', 'teamCode'];
                for (const fieldId of requiredFields) {
                    const value = document.getElementById(fieldId).value.trim();
                    if (!value) {
                        showAlert(`è«‹å¡«å¯«${fieldId}`, 'danger');
                        return;
                    }
                }

                const formData = {
                    company: document.getElementById('company').value.trim(),
                    company_code: document.getElementById('companyCode').value.trim(),
                    department: document.getElementById('department').value.trim(),
                    dept_code: document.getElementById('deptCode').value.trim(),
                    team_name: document.getElementById('teamName').value.trim(),
                    team_code: document.getElementById('teamCode').value.trim(),
                    description: document.getElementById('teamDescription').value.trim()
                };

                console.log('ğŸ“¤ å»ºç«‹åœ˜éšŠè³‡æ–™:', formData);

                // ä½¿ç”¨æ­£ç¢ºçš„ API URL
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(apiUrl + '/teams', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const result = await response.json();
                console.log('âœ… åœ˜éšŠå»ºç«‹æˆåŠŸ:', result);

                // å¦‚æœæœ‰æª”æ¡ˆéœ€è¦ä¸Šå‚³ï¼Œä½¿ç”¨è¿”å›çš„ team_id
                if (selectedFiles.length > 0) {
                    const teamId = result.team_id || `${formData.company_code}-${formData.department_code}-${formData.section_code}`;
                    console.log('ğŸ“ é–‹å§‹ä¸Šå‚³æ–‡ä»¶åˆ°åœ˜éšŠ:', teamId);
                    try {
                        await uploadFilesWithAPI(teamId, selectedFiles);
                        console.log('âœ… æª”æ¡ˆä¸Šå‚³å®Œæˆ');
                    } catch (fileError) {
                        console.error('âŒ æª”æ¡ˆä¸Šå‚³å¤±æ•—:', fileError);
                        showAlert('åœ˜éšŠå»ºç«‹æˆåŠŸï¼Œä½†æª”æ¡ˆä¸Šå‚³å¤±æ•—: ' + fileError.message, 'warning');
                    }
                }

                // é—œé–‰ modal ä¸¦é‡æ–°è¼‰å…¥è³‡æ–™
                bootstrap.Modal.getInstance(document.getElementById('addTeamModal')).hide();
                resetAddForm();
                fetchTeams();
                showAlert('åœ˜éšŠå»ºç«‹æˆåŠŸï¼', 'success');

            } catch (error) {
                console.error('âŒ å»ºç«‹åœ˜éšŠå¤±æ•—:', error);
                showAlert('å»ºç«‹åœ˜éšŠå¤±æ•—: ' + error.message, 'danger');
            }
        }

        // é¡¯ç¤ºç·¨è¼¯ Modal
        function showEditModal(teamId) {
            console.log('ğŸ”§ é–‹å§‹ç·¨è¼¯åœ˜éšŠ:', teamId);
            
            const team = teamsData.find(t => t.team_id === teamId);
            if (!team) {
                console.error('âŒ æ‰¾ä¸åˆ°åœ˜éšŠè³‡æ–™:', teamId);
                showAlert('æ‰¾ä¸åˆ°åœ˜éšŠè³‡æ–™', 'danger');
                return;
            }
            
            console.log('ğŸ“‹ è¼‰å…¥åœ˜éšŠè³‡æ–™é€²è¡Œç·¨è¼¯:', team);

            // å¡«å…¥åŸºæœ¬è³‡è¨Šï¼Œè™•ç†ä¸åŒçš„æ¬„ä½åç¨±
            document.getElementById('editTeamId').value = team.team_id || '';
            document.getElementById('editCompany').value = team.company || '';
            document.getElementById('editCompanyCode').value = team.company_code || '';
            document.getElementById('editDepartment').value = team.department || '';
            
            // è™•ç†éƒ¨é–€ä»£ç¢¼çš„ä¸åŒåç¨±
            const deptCode = team.department_code || team.dept_code || '';
            document.getElementById('editDeptCode').value = deptCode;
            
            document.getElementById('editTeamName').value = team.team_name || '';
            
            // è™•ç†åœ˜éšŠä»£ç¢¼çš„ä¸åŒåç¨±
            const teamCode = team.section_code || team.team_code || '';
            document.getElementById('editTeamCode').value = teamCode;
            
            // è™•ç†æè¿°çš„ä¸åŒåç¨±
            const description = team.description || team.team_description || '';
            document.getElementById('editTeamDescription').value = description;

            console.log('âœ… ç·¨è¼¯è¡¨å–®å¡«å…¥å®Œæˆ:', {
                teamId: team.team_id,
                company: team.company,
                companyCode: team.company_code,
                department: team.department,
                deptCode: deptCode,
                teamName: team.team_name,
                teamCode: teamCode,
                description: description
            });

            // æ¸…ç©ºç·¨è¼¯æ–‡ä»¶åˆ—è¡¨
            editSelectedFiles = [];
            renderFileList(editSelectedFiles, document.getElementById('editFileList'));

            // é¡¯ç¤ºç¾æœ‰æ–‡ä»¶ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            displayExistingFiles(team.team_id);

            // é¡¯ç¤ºæ¨¡æ…‹æ¡†
            new bootstrap.Modal(document.getElementById('editTeamModal')).show();
        }

        // æ›´æ–°åœ˜éšŠ
        async function updateTeam() {
            try {
                const teamId = document.getElementById('editTeamId').value;
                
                // åªç™¼é€å…è¨±æ›´æ–°çš„æ¬„ä½ï¼Œä¸åŒ…æ‹¬æœƒå½±éŸ¿ team_id çš„ code æ¬„ä½
                const formData = {
                    company: document.getElementById('editCompany').value.trim(),
                    department: document.getElementById('editDepartment').value.trim(),
                    team_name: document.getElementById('editTeamName').value.trim(),
                    description: document.getElementById('editTeamDescription').value.trim()
                };

                console.log('ğŸ“¤ æ›´æ–°åœ˜éšŠè³‡æ–™:', formData);
                console.log('ğŸ”’ å—ä¿è­·çš„æ¬„ä½ï¼ˆä¸æœƒæ›´æ–°ï¼‰: company_code, department_code, section_code');

                // ä½¿ç”¨æ­£ç¢ºçš„ API URL
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(apiUrl + '/teams/' + teamId, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const result = await response.json();
                console.log('âœ… åœ˜éšŠæ›´æ–°æˆåŠŸ:', result);

                // å¦‚æœæœ‰æ–°æ–‡ä»¶éœ€è¦ä¸Šå‚³
                if (editSelectedFiles.length > 0) {
                    console.log('ğŸ“ é–‹å§‹ä¸Šå‚³æ–°æ–‡ä»¶åˆ°åœ˜éšŠ:', teamId);
                    try {
                        await uploadFilesWithAPI(teamId, editSelectedFiles);
                        console.log('âœ… æ–°æª”æ¡ˆä¸Šå‚³å®Œæˆ');
                    } catch (fileError) {
                        console.error('âŒ æª”æ¡ˆä¸Šå‚³å¤±æ•—:', fileError);
                        showAlert('åœ˜éšŠæ›´æ–°æˆåŠŸï¼Œä½†æª”æ¡ˆä¸Šå‚³å¤±æ•—: ' + fileError.message, 'warning');
                    }
                }

                // é—œé–‰ modal ä¸¦é‡æ–°è¼‰å…¥è³‡æ–™
                bootstrap.Modal.getInstance(document.getElementById('editTeamModal')).hide();
                fetchTeams();
                showAlert('åœ˜éšŠæ›´æ–°æˆåŠŸï¼', 'success');

            } catch (error) {
                console.error('âŒ æ›´æ–°åœ˜éšŠå¤±æ•—:', error);
                showAlert('æ›´æ–°åœ˜éšŠå¤±æ•—: ' + error.message, 'danger');
            }
        }

        // åˆªé™¤åœ˜éšŠ
        async function deleteTeam(teamId) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹åœ˜éšŠå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ åˆªé™¤åœ˜éšŠ:', teamId);

                // ä½¿ç”¨æ­£ç¢ºçš„ API URL
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(`${apiUrl}/teams/${encodeURIComponent(teamId)}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                console.log('âœ… åœ˜éšŠåˆªé™¤æˆåŠŸ');
                fetchTeams();
                showAlert('åœ˜éšŠåˆªé™¤æˆåŠŸï¼', 'success');

            } catch (error) {
                console.error('âŒ åˆªé™¤åœ˜éšŠå¤±æ•—:', error);
                showAlert('åˆªé™¤åœ˜éšŠå¤±æ•—: ' + error.message, 'danger');
            }
        }

        // é¡¯ç¤ºåœ˜éšŠè©³æƒ…
        function showTeamDetail(teamId) {
            const team = teamsData.find(t => t.team_id === teamId);
            if (!team) return;

            const content = document.getElementById('teamDetailContent');
            content.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-building me-2"></i>å…¬å¸</h6>
                        <p class="border-bottom pb-2">${team.company || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-building me-2"></i>éƒ¨é–€</h6>
                        <p class="border-bottom pb-2">${team.department || 'æœªè¨­å®š'}</p>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-users me-2"></i>åœ˜éšŠåç¨±</h6>
                        <p class="border-bottom pb-2">${team.team_name || 'æœªè¨­å®š'}</p>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-code me-2"></i>åœ˜éšŠä»£ç¢¼</h6>
                        <p class="border-bottom pb-2">${team.company_code}-${team.dept_code}-${team.team_code}</p>
                    </div>
                </div>
                <div class="mb-3">
                    <h6><i class="fas fa-info-circle me-2"></i>åœ˜éšŠæè¿°</h6>
                    <p class="border-bottom pb-2">${team.description || 'æœªè¨­å®š'}</p>
                </div>
                <div class="mb-3">
                    <h6><i class="fas fa-file me-2"></i>ç›¸é—œæ–‡ä»¶</h6>
                    <div id="teamFiles" class="border rounded p-3 bg-light">
                        è¼‰å…¥ä¸­...
                    </div>
                </div>
                <div class="text-muted small">
                    <p><strong>åœ˜éšŠ ID:</strong> ${team.team_id}</p>
                    <p><strong>å»ºç«‹æ™‚é–“:</strong> ${team.created_at || 'æœªçŸ¥'}</p>
                    <p><strong>æœ€å¾Œæ›´æ–°:</strong> ${team.updated_at || 'æœªçŸ¥'}</p>
                </div>
            `;

            // è¨­ç½®ç·¨è¼¯æŒ‰éˆ•çš„ team_id
            document.getElementById('editFromDetail').setAttribute('data-team-id', teamId);

            // è¼‰å…¥æ–‡ä»¶åˆ—è¡¨
            loadTeamFiles(teamId);

            new bootstrap.Modal(document.getElementById('teamDetailModal')).show();
        }

        // è¼‰å…¥åœ˜éšŠæ–‡ä»¶
        async function loadTeamFiles(teamId) {
            const container = document.getElementById(`files-${teamId}`);
            if (!container) return;

            try {
                console.log('ğŸ“‚ è¼‰å…¥åœ˜éšŠæ–‡ä»¶:', teamId);
                
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                const response = await fetch(`${apiUrl}/teams/${encodeURIComponent(teamId)}?action=files`);

                if (!response.ok) {
                    container.innerHTML = '<p class="text-danger">è¼‰å…¥æ–‡ä»¶å¤±æ•—</p>';
                    return;
                }

                const result = await response.json();
                const files = result.files || [];

                if (files.length === 0) {
                    container.innerHTML = '<p class="text-muted">ç›®å‰æ²’æœ‰ä»»ä½•æ–‡ä»¶</p>';
                    return;
                }

                const fileList = files.map(file => {
                    // å¾ S3 key ä¸­æå–æ–‡ä»¶åç¨± (ç§»é™¤ team_info_docs/{teamId}/ å‰ç¶´)
                    const fileName = file.key ? file.key.replace(`team_info_docs/${teamId}/`, '') : file.name || 'æœªçŸ¥æ–‡ä»¶';
                    const uploadDate = file.lastModified ? new Date(file.lastModified).toLocaleString('zh-TW') : 'æœªçŸ¥';
                    const fileSize = file.size ? (file.size / 1024).toFixed(1) + ' KB' : 'æœªçŸ¥';
                    
                    return `
                        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                            <div>
                                <i class="fas fa-file me-2 text-primary"></i>
                                <strong>${fileName}</strong>
                                <div class="small text-muted">
                                    <i class="fas fa-weight-hanging me-1"></i>å¤§å°: ${fileSize}
                                    <i class="fas fa-clock ms-2 me-1"></i>ä¸Šå‚³: ${uploadDate}
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-success" onclick="downloadTeamFile('${fileName}', '${teamId}')" title="ä¸‹è¼‰æ–‡ä»¶">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteTeamFile('${file.key || file.name}', '${teamId}')" title="åˆªé™¤æ–‡ä»¶">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = fileList;
            } catch (error) {
                console.error('âŒ è¼‰å…¥åœ˜éšŠæ–‡ä»¶å¤±æ•—:', error);
                container.innerHTML = '<p class="text-danger">è¼‰å…¥æ–‡ä»¶å¤±æ•—</p>';
            }
        }

        // ä¸‹è¼‰åœ˜éšŠæ–‡ä»¶
        async function downloadTeamFile(fileName, teamId) {
            try {
                console.log('ğŸ“¥ ä¸‹è¼‰æ–‡ä»¶:', fileName, 'åœ˜éšŠ:', teamId);
                
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                // ä½¿ç”¨æª”æ¡ˆåç¨±å’Œ team_id åƒæ•¸ï¼Œé¿å… URL è·¯å¾‘ä¸­çš„æ–œç·šå•é¡Œ
                const encodedFileName = encodeURIComponent(fileName);
                const response = await fetch(`${apiUrl}/download-team-file/${encodedFileName}?team_id=${encodeURIComponent(teamId)}`);
                
                if (!response.ok) {
                    throw new Error(`ä¸‹è¼‰å¤±æ•—: ${response.status}`);
                }

                const result = await response.json();
                console.log('ğŸ“¥ ä¸‹è¼‰ URL å–å¾—æˆåŠŸ:', result);
                
                // é–‹å•Ÿä¸‹è¼‰ URL
                window.open(result.downloadUrl, '_blank');
                
            } catch (error) {
                console.error('âŒ ä¸‹è¼‰æ–‡ä»¶å¤±æ•—:', error);
                showAlert('ä¸‹è¼‰æ–‡ä»¶å¤±æ•—: ' + error.message, 'danger');
            }
        }

        // åˆªé™¤åœ˜éšŠæ–‡ä»¶
        async function deleteTeamFile(fileKey, teamId) {
            if (!confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡ä»¶ "${fileKey}" å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`)) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ åˆªé™¤æ–‡ä»¶:', fileKey);
                
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(`${apiUrl}/delete-team-file`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        key: fileKey
                    })
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        showAlert('åˆªé™¤åŠŸèƒ½é–‹ç™¼ä¸­...', 'info');
                        return;
                    }
                    throw new Error(`åˆªé™¤å¤±æ•—: ${response.status}`);
                }

                console.log('âœ… æ–‡ä»¶åˆªé™¤æˆåŠŸ');
                showAlert('æ–‡ä»¶åˆªé™¤æˆåŠŸ', 'success');
                
                // é‡æ–°è¼‰å…¥æ–‡ä»¶åˆ—è¡¨
                loadTeamFiles(teamId);
                
            } catch (error) {
                console.error('âŒ åˆªé™¤æ–‡ä»¶å¤±æ•—:', error);
                showAlert('åˆªé™¤æ–‡ä»¶å¤±æ•—: ' + error.message, 'danger');
            }
        }

        // é¡¯ç¤ºç¾æœ‰æ–‡ä»¶
        async function displayExistingFiles(teamId) {
            const container = document.getElementById('existingFiles');
            try {
                console.log('ğŸ“‚ è¼‰å…¥ç¾æœ‰æ–‡ä»¶:', teamId);
                
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(`${apiUrl}/teams/${encodeURIComponent(teamId)}?action=files`, {
                    method: 'GET'
                });

                if (response.ok) {
                    const result = await response.json();
                    const files = result.files || [];
                    
                    if (!files || files.length === 0) {
                        container.innerHTML = '<p class="text-muted">å°šç„¡ç¾æœ‰æ–‡ä»¶</p>';
                        return;
                    }

                    const fileList = files.map(file => {
                        // ä½¿ç”¨å›å‚³çš„æª”æ¡ˆåç¨±
                        const fileName = file.name || 'æœªçŸ¥æª”æ¡ˆ';
                        const fileSize = file.size ? (file.size / 1024).toFixed(1) + ' KB' : 'æœªçŸ¥';
                        const uploadDate = file.lastModified ? new Date(file.lastModified).toLocaleString('zh-TW') : 'æœªçŸ¥';
                        
                        return `
                            <div class="d-flex justify-content-between align-items-center border-bottom py-1">
                                <div>
                                    <span><i class="fas fa-file me-2"></i>${fileName}</span>
                                    <div class="small text-muted">
                                        å¤§å°: ${fileSize} | ä¸Šå‚³: ${uploadDate}
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${file.key}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                    }).join('');
                    
                    container.innerHTML = fileList;
                } else {
                    console.error('âŒ è¼‰å…¥ç¾æœ‰æ–‡ä»¶å¤±æ•—:', response.status);
                    container.innerHTML = '<p class="text-danger">è¼‰å…¥ç¾æœ‰æ–‡ä»¶å¤±æ•—</p>';
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥ç¾æœ‰æ–‡ä»¶å¤±æ•—:', error);
                container.innerHTML = '<p class="text-danger">è¼‰å…¥ç¾æœ‰æ–‡ä»¶å¤±æ•—</p>';
            }
        }

        // ä½¿ç”¨æ–°çš„ API ä¸Šå‚³æ–‡ä»¶åˆ°åœ˜éšŠ
        async function uploadFilesWithAPI(teamId, files) {
            if (!files || files.length === 0) {
                console.log('âš ï¸  æ²’æœ‰æ–‡ä»¶éœ€è¦ä¸Šå‚³');
                return;
            }
            
            console.log('ğŸ“ æº–å‚™ä¸Šå‚³æ–‡ä»¶:', files.length, 'å€‹æ–‡ä»¶åˆ°åœ˜éšŠ:', teamId);
            
            try {
                const results = [];
                for (const file of files) {
                    const result = await uploadSingleFileWithAPI(teamId, file);
                    results.push(result);
                }
                console.log('âœ… æ‰€æœ‰æ–‡ä»¶ä¸Šå‚³å®Œæˆ:', results);
                return results;
            } catch (error) {
                console.error('âŒ æ–‡ä»¶ä¸Šå‚³å¤±æ•—:', error);
                throw error;
            }
        }

        // ä½¿ç”¨æ–°çš„ API ä¸Šå‚³å–®å€‹æ–‡ä»¶
        async function uploadSingleFileWithAPI(teamId, file) {
            console.log(`ğŸ“¤ ä¸Šå‚³æ–‡ä»¶: ${file.name} åˆ°åœ˜éšŠ ${teamId}`);
            
            try {
                // å‰µå»º FormData é€²è¡Œæ–‡ä»¶ä¸Šå‚³
                const formData = new FormData();
                formData.append('file', file);

                // ä½¿ç”¨æ­£ç¢ºçš„ API URL - ä½¿ç”¨æ–°çš„æª”æ¡ˆä¸Šå‚³è·¯ç”±
                const apiUrl = window.CONFIG ? window.CONFIG.API_BASE_URL : 'https://44wy0r4r16.execute-api.ap-southeast-1.amazonaws.com/dev';
                
                const response = await fetch(`${apiUrl}/teams/${encodeURIComponent(teamId)}/files`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`ä¸Šå‚³å¤±æ•— HTTP ${response.status}: ${errorText}`);
                }

                const result = await response.json();
                console.log(`âœ… æ–‡ä»¶ ${file.name} ä¸Šå‚³æˆåŠŸ:`, result);
                
                return {
                    success: true,
                    filename: file.name,
                    ...result
                };
                
            } catch (error) {
                console.error(`âŒ æ–‡ä»¶ ${file.name} ä¸Šå‚³å¤±æ•—:`, error);
                throw error;
            }
        }

        // é‡ç½®æ–°å¢è¡¨å–®
        function resetAddForm() {
            document.getElementById('addTeamForm').reset();
            selectedFiles = [];
            renderFileList(selectedFiles, document.getElementById('fileList'));
        }

        // é¡¯ç¤ºè­¦å‘Šè¨Šæ¯
        function showAlert(message, type = 'info') {
            // ç§»é™¤ç¾æœ‰çš„ alert
            const existingAlert = document.querySelector('.alert-dismissible');
            if (existingAlert) {
                existingAlert.remove();
            }

            // å»ºç«‹æ–°çš„ alert
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 3ç§’å¾Œè‡ªå‹•é—œé–‰
            setTimeout(() => {
                if (alertDiv && alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // æ›´æ–°æ‰€æœ‰é è¦½
        function updateAllPreviews() {
            updateCompanyCodePreview();
            updateTeamIdPreview();
            updateFullTeamNamePreview();
        }

        // æ›´æ–°å…¬å¸ä»£ç¢¼é è¦½
        function updateCompanyCodePreview() {
            const companyCode = document.getElementById('companyCode').value.trim().toUpperCase();
            const previewElement = document.getElementById('companyCodePreview');
            
            if (companyCode) {
                previewElement.innerHTML = `<code>${companyCode}</code>`;
                previewElement.className = 'fw-bold text-success';
            } else {
                previewElement.textContent = 'è«‹å¡«å¯«å…¬å¸ä»£ç¢¼';
                previewElement.className = 'fw-bold text-muted';
            }
        }

        // æ›´æ–°åœ˜éšŠ ID é è¦½
        function updateTeamIdPreview() {
            const companyCode = document.getElementById('companyCode').value.trim().toUpperCase();
            const deptCode = document.getElementById('deptCode').value.trim().toUpperCase();
            const teamCode = document.getElementById('teamCode').value.trim().toUpperCase();
            
            const previewElement = document.getElementById('teamIdPreview');
            
            if (companyCode && deptCode && teamCode) {
                const teamId = `${companyCode}-${deptCode}-${teamCode}`;
                previewElement.innerHTML = `<code>${teamId}</code>`;
                previewElement.className = 'fw-bold text-primary';
            } else {
                previewElement.textContent = 'è«‹å¡«å¯«å¿…è¦æ¬„ä½';
                previewElement.className = 'fw-bold text-muted';
            }
        }

        // æ›´æ–°å®Œæ•´åœ˜éšŠåç¨±é è¦½
        function updateFullTeamNamePreview() {
            const company = document.getElementById('company').value.trim();
            const department = document.getElementById('department').value.trim();
            const teamName = document.getElementById('teamName').value.trim();
            
            const previewElement = document.getElementById('fullTeamNamePreview');
            
            if (company && department && teamName) {
                previewElement.textContent = `${company} - ${department} - ${teamName}`;
                previewElement.className = 'fw-bold text-success';
            } else {
                previewElement.textContent = 'è«‹å¡«å¯«åœ˜éšŠè³‡è¨Š';
                previewElement.className = 'fw-bold text-muted';
            }
        }
    </script>
    
    <!-- è¼‰å…¥å¿…è¦çš„ JavaScript æª”æ¡ˆ -->
    <script src="js/teams-api.js"></script>
    <script src="js/teams-ui.js"></script>
    
    <script>
        // åˆå§‹åŒ–å…¨åŸŸ API å¯¦ä¾‹
        let teamsAPI = null;
        let teamsUI = null;
        
        // ç­‰å¾…é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”¥ é–‹å§‹åˆå§‹åŒ–åœ˜éšŠç®¡ç†ç³»çµ±...');
            
            // æª¢æŸ¥é…ç½®
            if (window.CONFIG) {
                console.log('âœ… é…ç½®è¼‰å…¥æˆåŠŸ:', window.CONFIG);
            } else {
                console.error('âŒ é…ç½®è¼‰å…¥å¤±æ•—');
            }
            
            // åˆå§‹åŒ– API å®¢æˆ¶ç«¯
            teamsAPI = new TeamsAPI();
            console.log('âœ… åœ˜éšŠ API å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ');
            
            // åˆå§‹åŒ– UI ç®¡ç†å™¨
            teamsUI = new TeamsUI();
            teamsUI.init();
            console.log('âœ… åœ˜éšŠ UI ç®¡ç†å™¨åˆå§‹åŒ–æˆåŠŸ');
            
            // ç‚ºäº†å‘å¾Œå…¼å®¹ï¼Œä¹ŸåŸ·è¡ŒèˆŠçš„åˆå§‹åŒ–é‚è¼¯
            fetchTeams();
            initializeEventListeners();
        });
    </script>
</body>
</html>

